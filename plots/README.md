# Network Visualization Plots

This directory contains interactive network visualizations generated by the analysis pipeline. The plots are created using Python with the `plotly` and `networkx` libraries. Each plot is a self-contained HTML file that can be opened in any modern web browser.

The purpose of these visualizations is to provide a clear, interactive, and intuitive understanding of the electrical grid's topology, its potential failures under load, and the effectiveness of proposed reinforcements.

## How the Plots are Generated

The core logic for all visualizations resides in `src/visualization.py`. The process can be summarized as follows:

1.  **Input Data**: The visualization functions take a `networkx.Graph` object as input. This graph contains nodes (representing connection points, consumers, etc.) and edges (representing cables or links), along with their technical attributes.

2.  **Layout Calculation (`_compute_layout`)**: The positions of the nodes on the plot are determined by one of two methods:
    *   **Geographic Layout**: If the nodes in the graph have pre-defined `pos` attributes (e.g., from GIS coordinates), the plot will use these coordinates to create a geographically accurate representation of the network.
    *   **Abstract Layout**: If coordinates are not available, or if the `optimize_space=True` flag is used, the script falls back to an abstract graph layout algorithm (`spring_layout` or `kamada_kawai`). This mode prioritizes clarity and readability over geographic accuracy, arranging nodes to minimize visual clutter. Root nodes are pinned to the top to create a more hierarchical view.

3.  **Component Styling**: The script iterates through all nodes and edges in the graph and styles them based on their type and state (e.g., normal, failed, or reinforced). This includes assigning specific colors, sizes, and symbols to make the network's status immediately obvious.

4.  **Interactive Tooltips**: Rich, informative tooltips are generated for every node and link. Hovering your mouse over any element in the plot will reveal detailed information, such as component IDs, calculated current, overload percentages, or reinforcement costs.

5.  **Output**: The final plot is assembled using `plotly.graph_objects` and saved as an `.html` file in this `plots/` directory. The filename is typically in the format `network_visualization_{station_name}.html`. Note that subsequent plots generated for the same station name will overwrite the previous ones.

---

## Plot Descriptions

There are four primary types of visualizations that can be generated. Each serves a different purpose in the analysis workflow.

### 1. Base Network Topology

*   **Generated By**: `visualize_network_topology()`
*   **Purpose**: To provide a clean, high-level overview of the electrical grid's physical structure. This plot shows all the components and their connections without any load analysis.
*   **What it Shows**:
    *   **Nodes**: All network nodes are displayed according to the legend below (Root, Junction, Consumer).
    *   **Links**: All links are shown as standard grey lines.
    *   **Interactivity**: Hovering over a node reveals its ID and type. Hovering over a link shows the connection details and its maximum current capacity (`Irmax_hoch`).


*(Image placeholder for a base topology plot)*

### 2. Network with Failures

*   **Generated By**: `visualize_network_with_failures()`
*   **Purpose**: To identify and highlight weak points and bottlenecks in the network when it is under a specific load scenario. This is the primary diagnostic plot.
*   **What it Shows**:
    *   **Overloaded Links (Thick Red Lines)**: These are links where the calculated current exceeds the cable's maximum allowed capacity. The hover tooltip provides critical details:
        *   Maximum allowed current.
        *   Calculated peak current.
        *   The exact **overload percentage**.
    *   **Fuse Failures (Orange Open Squares)**: These are consumer nodes where a fuse is predicted to blow due to overload. The hover tooltip lists the specific consumers at that node that are affected and their overload percentages.
    *   All non-failing components are shown in their standard colors (grey links, green consumer nodes).


*(Image placeholder for a failure analysis plot)*

### 3. Reinforced Network

*   **Generated By**: `visualize_reinforced_network()`
*   **Purpose**: To display the final state of the network *after* the reinforcement plan has been applied. This plot confirms that the upgrades have been correctly modeled.
*   **What it Shows**:
    *   **Reinforced Links (Thick Blue Lines)**: These are the specific links that have been upgraded with a new, higher-capacity cable. The hover tooltip provides details about the upgrade:
        *   The new cable type used for reinforcement.
        *   The new, higher maximum current capacity.
        *   The **cost of the fix** for that specific link.
    *   The plot does not show any red failures, as it represents the "solved" state of the network.


*(Image placeholder for a reinforced network plot)*

### 4. Grid Improvement Analysis (Before & After)

*   **Generated By**: `visualize_grid_improvement()`
*   **Purpose**: This is the most powerful visualization, providing a direct "before and after" comparison on a single plot. It shows which problems were solved by which specific upgrades.
*   **What it Shows**: This plot uniquely combines elements from the failure and reinforcement visualizations.
    *   It displays the reinforced graph topology.
    *   **Overloaded Links (Thick Red Lines)**: It highlights the links that were *initially* failing before the reinforcement.
    *   **Reinforced Links (Thick Blue Lines)**: It overlays the upgrades that were implemented to fix the problems.
    *   **Insight**: By showing both red and blue lines, you can instantly see the cause-and-effect of the reinforcement plan. For example, you can verify that every red (failed) link has been addressed by a corresponding blue (reinforced) link. The plot title conveniently displays the total number of upgrades and the total reinforcement cost.


*(Image placeholder for a grid improvement plot)*

---

## Visual Legend

The following elements are used consistently across all plots:

#### **Nodes**
*   ðŸŸ¡ **Root Node (Gold Star)**: The starting point of the network, typically the transformer station.
*   âš« **Junction (Grey Circle)**: A simple connection point or branching point in the network with no consumers directly attached.
*   ðŸŸ© **Consumer (OK) (Green Square)**: Represents a connection point for one or more consumers. All consumers at this node are operating within their limits. The size of the square is proportional to the number of consumers.
*   ðŸŸ§ **Consumer (Fuse Failure) (Orange Open Square)**: A consumer node where at least one fuse has failed due to overload. Hover for details on which consumers failed.

#### **Links (Edges)**
*   âŽ¯ **Unchanged Link (Grey Line)**: A standard cable operating within its capacity.
*   âŽ¯ **Overloaded Link (Thick Red Line)**: A cable where the calculated current exceeds its maximum rating. A critical failure point.
*   âŽ¯ **Reinforced Link (Thick Blue Line)**: A cable that has been upgraded as part of the reinforcement plan. This link now has a higher capacity.